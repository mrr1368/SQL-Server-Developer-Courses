# 📚 جلسه هفدهم - آشنایی ساده با تریگرها در SQL Server

در این جلسه یاد می‌گیریم که تریگرها چطور کار می‌کنند. تریگرها به ما کمک می‌کنند وقتی داده‌ها تغییر می‌کنند، کارهای خاصی به صورت خودکار انجام شود. مثلاً وقتی اطلاعات جدید اضافه می‌شود یا چیزی ویرایش یا حذف می‌شود، تریگر می‌تواند این تغییرات را ثبت کند یا کارهای دیگری انجام دهد.

این مهارت‌ها برای مدیریت بهتر اطلاعات در پروژه‌های واقعی خیلی مهم هستند.

---

## 🗺️ خلاصه‌ی سریع چیزهایی که در این جلسه یاد می‌گیریم

| Topic | Description |
|:---|:---|
| CREATE TRIGGER | چطور یک تریگر بسازیم تا تغییرات را کنترل کند |
| inserted و deleted | چطور اطلاعات قبلی و جدید را ببینیم |
| Logging Changes | ذخیره تغییرات در جداول مثل jobs، publishers و titles |
| EndTime Management | تغییر تاریخ پایان رکوردهای قدیمی زمانی که قیمت تغییر می‌کند |
| System Stored Procedures | دیدن اطلاعات کاربران با `sp_who`, `sp_who2`, `@@SPID` |
| CROSS APPLY vs LEFT JOIN | فرق بین `CROSS APPLY` و `LEFT JOIN` در کار با داده‌ها |

---

## 🛠️ چیزهایی که در این جلسه یاد می‌گیریم

### 🎯 ساخت و استفاده از تریگرها

- چطور با `CREATE TRIGGER` یا `CREATE OR ALTER TRIGGER` یک تریگر بسازیم.

- چطور از جداول `inserted` و `deleted` برای گرفتن اطلاعات جدید و قبلی استفاده کنیم.

---

### 🎯 ثبت تغییرات با تریگرها

- چطور تغییرات در جدول‌های jobs و publishers را ثبت کنیم.

- چطور تغییر قیمت‌ها را پیگیری کنیم و اطلاعات قبلی را نگه داریم.

- چطور تاریخ پایان رکوردهای قبلی را به‌روزرسانی کنیم.

---

### 🎯 بررسی کاربران فعال و نحوه اتصال داده‌ها

- چطور با `sp_who`, `sp_who2`, `@@SPID` ببینیم چه کسانی به سیستم وصل هستند.

- چطور `CROSS APPLY` و `LEFT JOIN` را مقایسه کنیم و بفهمیم کجا بهتر هستند.

---

## 📜 درباره این جلسه

در این جلسه تمرین می‌کنیم:
- چطور تریگرهایی بسازیم که تغییرات را خودکار ثبت کنند.
- چطور تاریخچه تغییرات اطلاعات را ذخیره کنیم.
- چطور کاربران فعال را ببینیم و روش‌های اتصال داده‌ها را مقایسه کنیم.

تمرین‌های این جلسه روی دیتابیس **T_pubs** انجام شده‌اند.

---

## 📂 فایل موجود

- `Session 17.sql`: شامل نمونه‌های کامل از ساخت تریگر، ثبت تغییرات و بررسی نشست‌های کاربران.

---

## ⚡ نکات مهم

- تریگرها باید درست ساخته شوند تا باعث مشکلاتی مثل تکرار بی‌پایان نشوند.
- نوشتن شرط‌های دقیق در تریگرها به بهتر کار کردن سیستم کمک می‌کند.
- جداول `inserted` و `deleted` فقط اطلاعات رکوردهایی که تغییر کرده‌اند را نشان می‌دهند.

---

> ✨ این جلسه کمک می‌کند تا بتوانید بهتر تغییرات داده‌ها را مدیریت کنید و اطلاعات را به صورت حرفه‌ای ثبت کنید.

