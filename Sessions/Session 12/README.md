# 📚 جلسه دوازدهم - توابع پیشرفته پنجره‌ای (Advanced Window Functions)

در این جلسه یاد می‌گیریم چطور از توابع پنجره‌ای پیشرفته در SQL Server استفاده کنیم. این توابع به ما کمک می‌کنند تا بدون خلاصه کردن داده‌ها، محاسبات دقیقی روی هر ردیف انجام بدهیم و تحلیل‌های پیشرفته‌تری انجام دهیم.

این مباحث برای ساخت گزارش‌های حرفه‌ای، تحلیل روند تغییرات داده و مدیریت بهتر داده‌های حجیم بسیار کاربردی هستند.

---

## 🛠️ چیزهایی که در این جلسه یاد می‌گیریم

### 🎯 توابع شماره‌گذاری و رتبه‌بندی (Row Numbering and Ranking)

| دستور | توضیح |
|:---|:---|
| `ROW_NUMBER()` | شماره‌گذاری ردیف‌ها به ترتیب خاص |
| `RANK()` | رتبه‌بندی ردیف‌ها با درنظر گرفتن رکوردهای تکراری |
| `DENSE_RANK()` | رتبه‌بندی بدون ایجاد فاصله بین رتبه‌ها |
| `NTILE()` | تقسیم رکوردها به گروه‌های مساوی |

### 🎯 توابع مقایسه مقادیر (Comparing Rows)

| دستور | توضیح |
|:---|:---|
| `LAG()` | دسترسی به مقدار قبلی یک ردیف |
| `LEAD()` | دسترسی به مقدار بعدی یک ردیف |

### 🎯 توابع تجمیعی با پنجره (Aggregation with Window)

| دستور | توضیح |
|:---|:---|
| `SUM() OVER()` | محاسبه مجموع مقادیر بدون خلاصه کردن داده‌ها |
| `AVG() OVER()` | محاسبه میانگین مقادیر بدون خلاصه کردن داده‌ها |

### 🎯 مفاهیم پیشرفته پنجره‌ای

| موضوع | توضیح |
|:---|:---|
| `PARTITION BY` در توابع پنجره‌ای | تقسیم داده‌ها به گروه‌های داخلی قبل از محاسبه |
| Frame Definitions | تعیین بازه محاسباتی با `ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW` |
| Window Definitions | تعریف پنجره‌های تکراری با `WINDOW w AS (...)` |
| `SEQUENCE` | تولید شناسه‌های ترتیبی جدید در دیتابیس |

---

## 📜 درباره این جلسه

در این جلسه تمرین می‌کنیم:
- چطور برای هر ردیف شماره یا رتبه مشخص کنیم.
- چطور مقدار قبلی یا بعدی را در داده‌ها مقایسه کنیم.
- چطور مجموع یا میانگین مقادیر را روی گروه‌های خاص محاسبه کنیم.
- چطور پنجره‌های اختصاصی برای محاسبات خود تعریف کنیم.
- چطور شناسه‌های ترتیبی ایجاد کنیم.

مثال‌ها روی دیتابیس‌های **pubs** و **AdventureWorks2022** انجام شده تا یادگیری آسان‌تر شود.

---

## 📂 فایل موجود

- `Session 12.sql`: شامل نمونه‌های واقعی از کار با توابع پیشرفته پنجره‌ای و تحلیل‌های داده.

---

## ⚡ نکات مهم

- استفاده از توابع پنجره‌ای باعث می‌شود محاسبات دقیق‌تری روی داده‌ها انجام شود بدون اینکه داده‌ها خلاصه شوند.
- `LAG()` و `LEAD()` برای تحلیل روند تغییرات داده‌ها بسیار مفید هستند.
- استفاده از Frameها در محاسبات می‌تواند روی دقت و سرعت نتایج تاثیر زیادی داشته باشد.
- تعریف درست Windowها و مدیریت بهینه آن‌ها باعث بهبود خوانایی و کارایی کوئری‌ها می‌شود.

---

> ✨ این جلسه قدم بزرگی به سوی تحلیل‌های حرفه‌ای‌تر با SQL Server است و مهارت‌هایی که یاد می‌گیرید در پروژه‌های جدی و سازمانی بسیار کاربردی خواهند بود.

