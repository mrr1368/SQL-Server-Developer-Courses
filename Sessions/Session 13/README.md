# 📚 جلسه سیزدهم - بررسی پیشرفته دستورات DML (INSERT, UPDATE, DELETE, MERGE)

در این جلسه به صورت کامل و پیشرفته با دستورات DML در SQL Server آشنا می‌شویم. تمرکز این جلسه بر درج، به‌روزرسانی، حذف و ادغام داده‌ها در جداول است و روش‌های بهینه برای کار با داده‌ها آموزش داده می‌شود.

این مباحث برای ساخت پروژه‌های واقعی، بهینه‌سازی عملیات داده و کار با حجم بالای رکوردها بسیار کاربردی هستند.

---

## 🗺️ خلاصه‌ی سریع موضوعات این جلسه

| دستور | توضیح |
|:---|:---|
| `SELECT INTO` | ساخت جدول جدید و درج داده‌ها به طور مستقیم |
| `INSERT INTO ... SELECT` | درج داده‌های انتخابی از یک جدول دیگر |
| `OUTPUT` در INSERT | مشاهده رکوردهای درج‌شده به صورت همزمان |
| `SCOPE_IDENTITY()`, `@@IDENTITY`, `IDENT_CURRENT()` | دریافت شناسه آخرین رکورد درج‌شده |
| `UPDATE` شرطی با `CASE` | به‌روزرسانی رکوردها بر اساس شرط‌های خاص |
| `OUTPUT` در UPDATE | مشاهده تغییرات قبل و بعد از به‌روزرسانی |
| `DELETE` با شرط | حذف رکوردها با شرط‌های مختلف یا با JOIN/CTE |
| `MERGE` | ادغام داده‌های دو جدول با انجام INSERT، UPDATE و DELETE در یک دستور |
| `ORDER BY NEWID()` | تولید داده‌های تصادفی برای تست |
| جداول موقتی (`#TempTables`) | استفاده از جداول موقت برای عملیات سریع و ایزوله |

---

## 🛠️ چیزهایی که در این جلسه یاد می‌گیریم

### 🎯 دستورات درج داده (INSERT)

| دستور | توضیح |
|:---|:---|
| `SELECT INTO` | ساخت جدول جدید و درج داده‌ها در آن به طور مستقیم |
| `INSERT INTO ... SELECT` | درج داده‌های انتخابی از یک جدول دیگر |
| `OUTPUT` در INSERT | مشاهده رکوردهای درج‌شده به صورت همزمان |
| گرفتن آخرین مقدار درج شده | استفاده از `SCOPE_IDENTITY()`, `@@IDENTITY`, `IDENT_CURRENT()` برای دریافت آخرین شناسه درج‌شده |

### 🎯 دستورات به‌روزرسانی داده (UPDATE)

| دستور | توضیح |
|:---|:---|
| `UPDATE` شرطی | به‌روزرسانی رکوردها بر اساس شرط و استفاده از `CASE` در SET |
| `OUTPUT` در UPDATE | مشاهده داده‌های قبل و بعد از به‌روزرسانی |

### 🎯 دستورات حذف داده (DELETE)

| دستور | توضیح |
|:---|:---|
| `DELETE` با شرط | حذف رکوردها با استفاده از شرط‌های مختلف |
| `DELETE` با JOIN | حذف رکوردها با اتصال به جدول دیگر |
| `DELETE` با CTE | حذف رکوردها با کمک Common Table Expressions |

### 🎯 دستورات ادغام داده‌ها (MERGE)

| دستور | توضیح |
|:---|:---|
| `MERGE` | همگام‌سازی داده‌های دو جدول شامل INSERT، UPDATE و DELETE در یک دستور |

### 🎯 نکات ویژه و تکنیک‌های کمکی

| موضوع | توضیح |
|:---|:---|
| تولید داده نمونه | ساخت داده‌های تصادفی با `ORDER BY NEWID()` |
| جداول موقتی (`#TempTables`) | استفاده از جداول موقت برای عملیات DML سریع‌تر و ایزوله‌تر |

---

## 📜 درباره این جلسه

در این جلسه تمرین می‌کنیم:
- چطور جداول جدید بسازیم و داده‌ها را با روش‌های مختلف درج کنیم.
- چطور داده‌ها را شرطی به‌روزرسانی کنیم و تغییرات را همزمان مشاهده کنیم.
- چطور رکوردهای خاص را حذف کنیم یا از روش‌های ترکیبی برای حذف استفاده کنیم.
- چطور داده‌های دو جدول را به صورت هوشمند ادغام کنیم.
- چطور داده‌های نمونه تولید کنیم و از جداول موقت در پروژه‌ها بهره ببریم.

تمرین‌ها روی دیتابیس‌های **pubs** و **AdventureWorks2022** انجام شده‌اند.

---

## 📂 فایل موجود

- `Session 13.sql`: شامل نمونه‌های واقعی از دستورات پیشرفته DML و تکنیک‌های کاربردی.

---

## ⚡ نکات مهم

- هنگام استفاده از `MERGE` باید مراقب باشید تا شرایط `ON` دقیق نوشته شود.
- استفاده از `OUTPUT` در `INSERT`، `UPDATE` و `DELETE` می‌تواند به خطایابی و تست بهتر کوئری‌ها کمک کند.
- `SCOPE_IDENTITY()` امن‌ترین روش برای دریافت شناسه آخرین رکورد درج شده است.
- جداول موقت ابزاری قدرتمند برای پردازش‌های موقت و سریع هستند.

---

> ✨ این جلسه پایه‌ی تسلط بر دستورات تغییر داده‌ها در SQL Server را شکل می‌دهد و مهارت‌های شما را برای انجام پروژه‌های جدی تقویت می‌کند.

